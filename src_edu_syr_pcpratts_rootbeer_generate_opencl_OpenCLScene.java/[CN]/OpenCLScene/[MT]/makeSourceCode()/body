{
  m_usesGarbageCollector=false;
  Set<String> methods=RootbeerScene.v().getDfsInfo().getMethods();
  SignatureUtil util=new SignatureUtil();
  for (  String method_sig : methods) {
    String cls=util.classFromMethodSig(method_sig);
    String method_sub_sig=util.methodSubSigFromMethodSig(method_sig);
    SootClass soot_class=Scene.v().getSootClass(cls);
    SootMethod method=soot_class.getMethod(method_sub_sig);
    addMethod(method);
  }
  Set<SootField> fields=RootbeerScene.v().getDfsInfo().getFields();
  for (  SootField field : fields) {
    addField(field);
  }
  Set<ArrayType> array_types=RootbeerScene.v().getDfsInfo().getArrayTypes();
  for (  ArrayType array_type : array_types) {
    OpenCLArrayType ocl_array_type=new OpenCLArrayType(array_type);
    addArrayType(ocl_array_type);
  }
  StringBuilder ret=new StringBuilder();
  ret.append(headerString());
  ret.append(garbageCollectorString());
  ret.append(methodPrototypesString());
  ret.append(methodBodiesString());
  String prev_hash="";
  String curr_hash=DigestUtils.md5Hex(ret.toString());
  while (prev_hash.equals(curr_hash) == false) {
    ret=new StringBuilder();
    ret.append(headerString());
    ret.append(garbageCollectorString());
    ret.append(methodPrototypesString());
    ret.append(methodBodiesString());
    prev_hash=curr_hash;
    curr_hash=DigestUtils.md5Hex(ret.toString());
  }
  String cuda_code;
  if (true) {
    cuda_code=ret.toString();
  }
 else {
    cuda_code=readCudaCodeFromFile();
  }
  String mangle=NameMangling.v().mangle(VoidType.v());
  String replacement=getRuntimeBasicBlockClassName() + "_gpuMethod" + mangle;
  replacement=replacement.replace("$","\\$");
  cuda_code=cuda_code.replaceAll("%%invoke_run%%",replacement);
  PrintWriter writer=new PrintWriter(new FileWriter("generated.cu"));
  writer.println(cuda_code.toString());
  writer.flush();
  writer.close();
  return cuda_code;
}
