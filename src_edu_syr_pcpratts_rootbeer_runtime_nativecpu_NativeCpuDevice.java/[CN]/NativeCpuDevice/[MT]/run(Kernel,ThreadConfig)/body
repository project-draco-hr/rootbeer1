{
  int block_shape=thread_config.getGridShapeX();
  int thread_shape=thread_config.getBlockShapeX();
  int num_threads=thread_config.getNumThreads();
  NativeCpuGcHeap heap=new NativeCpuGcHeap(this);
  int size=heap.writeRuntimeBasicBlock(kernel_template,num_threads);
  m_Blocks=heap.getBlocks();
  List<Memory> mems=heap.getMemory();
  String lib_name=compileNativeCpuDev();
  BasicMemory to_space=(BasicMemory)mems.get(0);
  BasicMemory handles=(BasicMemory)mems.get(1);
  BasicMemory heap_end_ptr=(BasicMemory)mems.get(2);
  BasicMemory gc_info=(BasicMemory)mems.get(3);
  BasicMemory exceptions=(BasicMemory)mems.get(4);
  Serializer serializer=heap.getSerializer();
  runOnCpu(to_space.getBuffer(),to_space.getBuffer().size(),handles.getBuffer().get(0),heap_end_ptr.getBuffer().get(0),gc_info.getBuffer().get(0),exceptions.getBuffer().get(0),serializer.getClassRefArray(),num_threads,block_shape,thread_shape,lib_name);
  heap.readRuntimeBasicBlock(kernel_template,num_threads);
}
