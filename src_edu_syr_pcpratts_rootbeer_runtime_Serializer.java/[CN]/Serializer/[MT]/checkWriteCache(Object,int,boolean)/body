{
synchronized (mWriteToGpuCache) {
    if (mWriteToGpuCache.containsKey(o)) {
      long ref=mWriteToGpuCache.get(o);
      return new WriteCacheResult(ref,false);
    }
    Memory mem;
    if (read_only) {
      mem=mTextureMem;
    }
 else {
      mem=mMem;
    }
    long ref=mem.mallocWithSize(size);
    mWriteToGpuCache.put(o,ref);
    return new WriteCacheResult(ref,true);
  }
}
