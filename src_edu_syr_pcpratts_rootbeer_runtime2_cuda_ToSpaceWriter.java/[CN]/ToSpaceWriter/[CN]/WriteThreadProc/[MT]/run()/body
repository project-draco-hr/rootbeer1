{
  while (true) {
    List<Long> handles=new ArrayList<Long>();
    List<Kernel> items=new ArrayList<Kernel>();
    List<Kernel> not_written=new ArrayList<Kernel>();
    try {
      InputItem input_item=m_InputQueue.take();
      not_written.addAll(input_item.m_Items);
      for (      Kernel item : input_item.m_Items) {
        long handle=input_item.m_Visitor.writeToHeap(item);
        handles.add(handle);
        items.add(item);
        not_written.remove(0);
      }
    }
 catch (    OutOfMemoryError ex) {
      ex.printStackTrace();
      System.exit(1);
    }
 finally {
      m_OutputQueue.put(new ToSpaceWriterResult(handles,items,not_written));
    }
  }
}
