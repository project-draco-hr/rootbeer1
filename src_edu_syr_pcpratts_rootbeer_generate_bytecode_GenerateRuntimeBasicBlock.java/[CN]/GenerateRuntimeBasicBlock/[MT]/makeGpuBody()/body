{
  OpenCLScene.v().addCodeSegment(codeSegment);
  if (Configuration.compilerInstance().getMode() == Configuration.MODE_GPU) {
    CompileResult result=OpenCLScene.v().getCudaCode();
    if (result.getBinary() == null) {
      makeGetCodeMethodThatReturnsBytes(cubinFilename(false) + ".error");
      makeGetCodeMethodThatReturnsString("");
    }
 else {
      List<byte[]> bytes=result.getBinary();
      writeBytesToFile(bytes,cubinFilename(true));
      makeGetCodeMethodThatReturnsBytes(cubinFilename(false));
      makeGetCodeMethodThatReturnsString("");
    }
  }
 else {
    String code=OpenCLScene.v().getOpenCLCode();
    System.out.println("removing dead methods...");
    DeadMethods dead_methods=new DeadMethods("entry");
    code=dead_methods.filter(code);
    makeGetCodeMethodThatReturnsString(code);
    makeGetCodeMethodThatReturnsBytes("");
  }
}
